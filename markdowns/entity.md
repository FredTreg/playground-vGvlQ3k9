# Entity definition

Dans le monde des ORM, les classes gérées par le framework de persistance sont appelés _entity_, elles vont être gérés en ajoutant au code objet existant des métadata qui permettront leurs persistance.  
Historiquement ces métadonnées ont été mis en place par Hibernate dans des fichiers de configurations _*.hbm_, depuis l'uniformisation des ORM en JEE via l'utilistion de JPA (Java Persistence API) il s'agit d'annotations.  

Les annotations sont des métadonnées incluses dans le code source Java d'une application. Elles sont donc accessibles au runtime par le code mais n'ont aucun impact direct sur le code.
Le package __javax.persistence__ contient toutes les annotations et classes nécessaires à intéragir avec JPA.

Avant de passer sur la définition de mapping complexe, nous allons déja nous concentrer sur une entity simple.  
Nous pouvons définir les entités d'un projet de deux manière différentes, TopDown et BottomUp.
 - TopDown : Le modèle objet sera a la base de votre réfléxion et votre modèle relationnel sera déduit à partir des métadonnées de persistances de votre code
 - BottomUp : Votre modèle objet devra définir des métadonnées pour définir exactement comment trnsformer votre modèle relationnel vers le modèle objet.
 

## Approche  TopDown

L'approche TopDown est l'approche la plus simple.  
Il s'agit de réaliser le modèle objet de votre applciation, de définir les métadonnées sur vos classes et de faire génré par un outil la structure de votre base de donnée.

Cette méthode permet d'avoir un modèle objet très proche du modèle relationnel mais elle n'optimise pas le schéma de base de donnnées.  

Nous allons utilisez cette méthode pour déinir la persistence d'une entity User.
@[User entity]({"stubs": ["src/main/stubs/User.java", "src/main/java/fr/fteychene/orm/jpabasics/entity/MaritalStatus.java"], "command": "fr.fteychene.orm.jpabasics.entity.TestEntityTopDown", "project":"entity"})
    
    
## Approche BottomUp

L'approche BottomUp est l'approche qui part de la abse de donnée.  
Elle consiste a définir le modèle de bse de donnée en premier et ensuite de mettre en place des métadonnées qui permettent d'utilsier son modèle objet sur cette abse de donnée.

Cette approche à l'avantage de permettre des optimisations dans la base de donnée mais peut engendrer des mapping déifficle dans le modèle objet.

Nous allons utiliser cette méthode pour redéfinir notre entity User pour correspondre à la base de donnée crée avec le script suivant :
```sql
CREATE TABLE USERS (
 ID bigint GENERATED BY DEFAULT AS IDENTITY (start with 1),
 BDATE timestamp,
 MAIL varchar(255),
 FIRST_NAME varchar(255) not null,
 LAST_NAME varchar(255),
 MSTATUS varchar(255),
 primary key (ID)
 );
```
@[Bottom UP]({"stubs": ["src/main/stubs/User.java"],"command": "fr.fteychene.orm.jpabasics.entity.TestEntityBottomUp", "project":"entity"})


    
## Links

[JEE7 Persistence tutorial](https://docs.oracle.com/javaee/7/tutorial/persistence-intro001.htm#BNBQA)  
[JBoss Hibernate docuementation](https://docs.jboss.org/hibernate/stable/annotations/reference/en/html/entity.html#entity-mapping)  
[JPA javadoc](https://docs.oracle.com/javaee/7/api/javax/persistence/package-summary.html)
